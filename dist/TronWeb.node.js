module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e){t.exports=require("source-map-support/register")},function(t,e){t.exports=require("bignumber.js")},function(t,e){t.exports=require("axios")},function(t,e){t.exports=require("ethers")},function(t,e){t.exports=require("js-sha3")},function(t,e){t.exports=require("elliptic")},function(t,e){t.exports=require("@babel/runtime/helpers/defineProperty")},function(t,e){t.exports=require("jssha")},function(t,e){t.exports=require("validator")},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"byte2hexStr",function(){return f}),r.d(n,"bytesToString",function(){return p}),r.d(n,"hextoString",function(){return g}),r.d(n,"base64DecodeFromString",function(){return v}),r.d(n,"byteArray2hexStr",function(){return b});var s={};r.r(s),r.d(s,"bin2String",function(){return x}),r.d(s,"arrayEquals",function(){return S}),r.d(s,"stringToBytes",function(){return k}),r.d(s,"bytesToString",function(){return P}),r.d(s,"hextoString",function(){return C}),r.d(s,"hexChar2byte",function(){return _}),r.d(s,"isHexChar",function(){return B}),r.d(s,"hexStr2byteArray",function(){return N}),r.d(s,"byte2hexStr",function(){return T}),r.d(s,"byteArray2hexStr",function(){return j}),r.d(s,"base64DecodeFromString",function(){return E}),r.d(s,"base64EncodeToString",function(){return F}),r.d(s,"strToDate",function(){return H}),r.d(s,"isNumber",function(){return O}),r.d(s,"getStringType",function(){return U});var i={};r.r(i),r.d(i,"encode58",function(){return D}),r.d(i,"decode58",function(){return K});var o={};r.r(o),r.d(o,"getBase58CheckAddress",function(){return $}),r.d(o,"decodeBase58Address",function(){return J}),r.d(o,"signTransaction",function(){return M}),r.d(o,"arrayToBase64String",function(){return X}),r.d(o,"signBytes",function(){return Z}),r.d(o,"getRowBytesFromTransactionBase64",function(){return G}),r.d(o,"genPriKey",function(){return Q}),r.d(o,"computeAddress",function(){return Y}),r.d(o,"getAddressFromPriKey",function(){return tt}),r.d(o,"decode58Check",function(){return et}),r.d(o,"isAddressValid",function(){return rt}),r.d(o,"getBase58CheckAddressFromPriKeyBase64String",function(){return nt}),r.d(o,"getHexStrAddressFromPriKeyBase64String",function(){return st}),r.d(o,"getAddressFromPriKeyBase64String",function(){return it}),r.d(o,"getPubKeyFromPriKey",function(){return ot}),r.d(o,"ECKeySign",function(){return at}),r.d(o,"SHA256",function(){return dt}),r.d(o,"passwordToAddress",function(){return ct}),r.d(o,"pkToAddress",function(){return ut});var a={};r.r(a),r.d(a,"generateAccount",function(){return lt});var d=r(6),c=r.n(d),u=(r(0),r(2)),l=r.n(u);function h(){this._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=(t=>{let e,r,n,s,i,o,a,d="",c=0;for(;c<t.length;)s=(e=t.charCodeAt(c++))>>2,i=(3&e)<<4|(r=t.charCodeAt(c++))>>4,o=(15&r)<<2|(n=t.charCodeAt(c++))>>6,a=63&n,isNaN(r)?o=a=64:isNaN(n)&&(a=64),d=d+this._keyStr.charAt(s)+this._keyStr.charAt(i)+this._keyStr.charAt(o)+this._keyStr.charAt(a);return d}),this.encodeIgnoreUtf8=(t=>{let e,r,n,s,i,o,a,d="",c=0;for(;c<t.length;)s=(e=t[c++])>>2,i=(3&e)<<4|(r=t[c++])>>4,o=(15&r)<<2|(n=t[c++])>>6,a=63&n,isNaN(r)?o=a=64:isNaN(n)&&(a=64),d=d+this._keyStr.charAt(s)+this._keyStr.charAt(i)+this._keyStr.charAt(o)+this._keyStr.charAt(a);return d}),this.decode=(t=>{let e,r,n,s,i,o,a,d="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=(s=_keyStr.indexOf(t.charAt(c++)))<<2|(i=_keyStr.indexOf(t.charAt(c++)))>>4,r=(15&i)<<4|(o=_keyStr.indexOf(t.charAt(c++)))>>2,n=(3&o)<<6|(a=_keyStr.indexOf(t.charAt(c++))),d+=String.fromCharCode(e),64!=o&&(d+=String.fromCharCode(r)),64!=a&&(d+=String.fromCharCode(n));return this._utf8_decode(d)}),this.decodeToByteArray=(t=>{let e,r,n,s,i,o,a,d="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=(s=_keyStr.indexOf(t.charAt(c++)))<<2|(i=_keyStr.indexOf(t.charAt(c++)))>>4,r=(15&i)<<4|(o=_keyStr.indexOf(t.charAt(c++)))>>2,n=(3&o)<<6|(a=_keyStr.indexOf(t.charAt(c++))),d+=String.fromCharCode(e),64!=o&&(d+=String.fromCharCode(r)),64!=a&&(d+=String.fromCharCode(n));return this._out2ByteArray(d)}),this._out2ByteArray=(t=>{const e=new Array(t.length);let r=0,n=c1=c2=0;for(;r<t.length;)n=t.charCodeAt(r),e[r]=n,r++;return e}),this._utf8_encode=(t=>{t=t.replace(/\r\n/g,"\n");let e="";for(let r=0;r<t.length;r++){const n=t.charCodeAt(r);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}),this._utf8_decode=(t=>{let e="",r=0,n=c1=c2=0;for(;r<t.length;)(n=t.charCodeAt(r))<128?(e+=String.fromCharCode(n),r++):n>191&&n<224?(c2=t.charCodeAt(r+1),e+=String.fromCharCode((31&n)<<6|63&c2),r+=2):(c2=t.charCodeAt(r+1),c3=t.charCodeAt(r+2),e+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),r+=3);return e})}function f(t){let e="";return e+="0123456789ABCDEF".charAt(t>>4),e+="0123456789ABCDEF".charAt(15&t)}function p(t){if("string"==typeof t)return t;let e="";for(let r=0;r<t.length;r++){const n=t[r].toString(2),s=n.match(/^1+?(?=0)/);if(s&&8===n.length){const n=s[0].length;let i=t[r].toString(2).slice(7-n);for(let e=1;e<n;e++)i+=t[e+r].toString(2).slice(2);e+=String.fromCharCode(parseInt(i,2)),r+=n-1}else e+=String.fromCharCode(t[r])}return e}function g(t){const e=t.split("");let r="";for(let t=0;t<e.length/2;t++){let n=`0x${e[2*t]}${e[2*t+1]}`;r+=String.fromCharCode(n)}return r}function v(t){return(new h).decodeToByteArray(t)}function b(t){let e="";for(let r=0;r<t.length;r++)e+=f(t[r]);return e}var m=r(7),y=r.n(m);const w="testnet"===process.env.NET,I=w?35:34,A=w?"a0":"41",W=w?160:65;function x(t){return String.fromCharCode(...t)}function S(t,e){if(t.length!=e.length)return!1;let r;for(r=0;r<t.length;r++)if(t[r]!=e[r])return!1;return!0}function k(t){const e=new Array;let r,n;r=t.length;for(let s=0;s<r;s++)(n=t.charCodeAt(s))>=65536&&n<=1114111?(e.push(n>>18&7|240),e.push(n>>12&63|128),e.push(n>>6&63|128),e.push(63&n|128)):n>=2048&&n<=65535?(e.push(n>>12&15|224),e.push(n>>6&63|128),e.push(63&n|128)):n>=128&&n<=2047?(e.push(n>>6&31|192),e.push(63&n|128)):e.push(255&n);return e}function P(t){if("string"==typeof t)return t;let e="";for(let r=0;r<t.length;r++){const n=t[r].toString(2),s=n.match(/^1+?(?=0)/);if(s&&8==n.length){const n=s[0].length;let i=t[r].toString(2).slice(7-n);for(let e=1;e<n;e++)i+=t[e+r].toString(2).slice(2);e+=String.fromCharCode(parseInt(i,2)),r+=n-1}else e+=String.fromCharCode(t[r])}return e}function C(t){const e=t.split("");let r="";for(let t=0;t<e.length/2;t++){const n=`0x${e[2*t]}${e[2*t+1]}`;r+=String.fromCharCode(n)}return r}function _(t){let e=0;return t>="A"&&t<="F"?e=t.charCodeAt(0)-"A".charCodeAt(0)+10:t>="a"&&t<="f"?e=t.charCodeAt(0)-"a".charCodeAt(0)+10:t>="0"&&t<="9"&&(e=t.charCodeAt(0)-"0".charCodeAt(0)),e}function B(t){return t>="A"&&t<="F"||t>="a"&&t<="f"||t>="0"&&t<="9"?1:0}function N(t){const e=Array();let r=0,n=0,s=0;for(let i=0;i<t.length;i++){const o=t.charAt(i);B(o)&&(r<<=4,r+=_(o),0==++n%2&&(e[s++]=r,r=0))}return e}function T(t){let e="";return e+="0123456789ABCDEF".charAt(t>>4),e+="0123456789ABCDEF".charAt(15&t)}function j(t){return t.reduce((t,e)=>t+T(e),"")}function E(t){return(new h).decodeToByteArray(t)}function F(t){return(new h).encodeIgnoreUtf8(t)}function H(t){const e=t.split(" "),r=e[0].split("-"),n=parseInt(r[0],10),s=parseInt(r[1],10)-1,i=parseInt(r[2],10);if(e.length>1){const t=e[1].split("-"),r=parseInt(t[0],10),o=parseInt(t[1],10)-1,a=parseInt(t[2],10);return new Date(n,s,i,r,o,a)}return new Date(n,s,i)}function O(t){return t>="0"&&t<="9"?1:0}function U(t){if(null==t)return-1;if("string"!=typeof t)return-1;if(0==t.length||""==t)return-1;let e=0;if(40==t.length)for(;e<40;e++){if(!B(t.charAt(e)))break}if(40==e)return 1;for(e=0;e<t.length;e++){if(!O(t.charAt(e)))break}if(e==t.length)return 2;for(e=0;e<t.length;e++){if(t.charAt(e)>" ")return 3}return-1}const q="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",R={};for(let t=0;t<q.length;t++)R[q.charAt(t)]=t;const L=58;function D(t){if(0===t.length)return"";let e,r;const n=[0];for(e=0;e<t.length;e++){for(r=0;r<n.length;r++)n[r]<<=8;n[0]+=t[e];let s=0;for(r=0;r<n.length;++r)n[r]+=s,s=n[r]/L|0,n[r]%=L;for(;s;)n.push(s%L),s=s/L|0}for(e=0;0===t[e]&&e<t.length-1;e++)n.push(0);return n.reverse().map(t=>q[t]).join("")}function K(t){if(0===t.length)return[];let e,r;const n=[0];for(e=0;e<t.length;e++){const s=t[e];if(!(s in R))throw new Error("Non-base58 character");for(r=0;r<n.length;r++)n[r]*=L;n[0]+=R[s];let i=0;for(r=0;r<n.length;++r)n[r]+=i,i=n[r]>>8,n[r]&=255;for(;i;)n.push(255&i),i>>=8}for(e=0;"1"===t[e]&&e<t.length-1;e++)n.push(0);return n.reverse()}var V=r(4),z=r(5);function $(t){let e=dt(dt(t)).slice(0,4);return D(e=t.concat(e))}function J(t){if("string"!=typeof t)return!1;if(t.length<=4)return!1;let e=K(t);if(t.length<=4)return!1;const r=e.length-4,n=e.slice(r),s=dt(dt(e=e.slice(0,r))).slice(0,4);return n[0]==s[0]&&n[1]==s[1]&&n[2]==s[2]&&n[3]==s[3]?e:N("000000000000000000000000000000000000000000")}function M(t,e){"string"==typeof t&&(t=N(t));const r=at(N(e.txID),t);return e.signature=[r],e}function X(t){return btoa(String.fromCharCode(...t))}function Z(t,e){return"string"==typeof t&&(t=N(t)),at(dt(e),t)}function G(t){const e=E(t);return proto.protocol.Transaction.deserializeBinary(e).getRawData().serializeBinary()}function Q(){let t=new z.ec("secp256k1").genKeyPair().getPrivate().toString("hex");for(;t.length<64;)t=`0${t}`;return N(t)}function Y(t){65===t.length&&(t=t.slice(1));const e=Object(V.keccak256)(t).toString();return N(A+e.substring(24))}function tt(t){return Y(ot(t))}function et(t){const e=K(t);if(e.length<=4)return!1;const r=e.slice(0,e.length-4),n=dt(dt(r));return n[0]===e[r.length]&&n[1]===e[r.length+1]&&n[2]===e[r.length+2]&&n[3]===e[r.length+3]&&r}function rt(t){if("string"!=typeof t)return!1;if(t.length!==I)return!1;let e=K(t);if(25!==e.length)return!1;if(e[0]!==W)return!1;const r=e.slice(21),n=dt(dt(e=e.slice(0,21))).slice(0,4);return r[0]==n[0]&&r[1]==n[1]&&r[2]==n[2]&&r[3]==n[3]}function nt(t){return $(Y(ot(E(t))))}function st(t){return b(Y(ot(E(t))))}function it(t){return F(Y(ot(E(t))))}function ot(t){const e=new z.ec("secp256k1").keyFromPrivate(t,"bytes").getPublic(),r=e.x,n=e.y;let s=r.toString("hex");for(;s.length<64;)s=`0${s}`;let i=n.toString("hex");for(;i.length<64;)i=`0${i}`;return N(`04${s}${i}`)}function at(t,e){const r=new z.ec("secp256k1").keyFromPrivate(e,"bytes").sign(t),n=r.r,s=r.s,i=r.recoveryParam;let o=n.toString("hex");for(;o.length<64;)o=`0${o}`;let a=s.toString("hex");for(;a.length<64;)a=`0${a}`;return o+a+f(i)}function dt(t){const e=new y.a("SHA-256","HEX"),r=b(t);return e.update(r),N(e.getHash("HEX"))}function ct(t){return $(tt(E(t)))}function ut(t){return $(tt(N(t)))}function lt(){const t=Q(),e=ot(t),r=tt(t);return{privateKey:b(t),publicKey:b(e),address:{base58:$(r),hex:b(r)}}}var ht=r(8),ft=r.n(ht),pt=r(1),gt=r.n(pt);var vt={...{isValidURL:t=>ft.a.isURL(t,{protocols:["http","https"]}),isObject:t=>t===Object(t)&&"[object Array]"!==Object.prototype.toString.call(t),isArray:t=>Array.isArray(t),isJson(t){try{return!!JSON.parse(t)}catch(t){return!1}},isBoolean:t=>"boolean"==typeof t,isBigNumber:t=>t&&(t instanceof gt.a||t.constructor&&"BigNumber"===t.constructor.name),isString:t=>"string"==typeof t||t&&t.constructor&&"String"===t.constructor.name,isFunction:t=>"function"==typeof t,isHex:t=>"string"==typeof t&&!isNaN(parseInt(t,16)),isInteger:t=>Number.isInteger(Number(t)),hasProperty:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),hasProperties(t,...e){return e.length&&!e.map(e=>this.hasProperty(t,e)).includes(!1)},injectPromise:(t,...e)=>new Promise((r,n)=>{t(...e,(t,e)=>{t?n(t):r(e)})}),promiseInjector(t){return(e,...r)=>this.injectPromise(e.bind(t),...r)},mapEvent:t=>({block:t.block_number,timestamp:t.block_timestamp,contract:t.contract_address,name:t.event_name,transaction:t.transaction_id,result:t.result}),parseEvent:(t,{inputs:e})=>t.result?(t.result=t.result.reduce((t,r,n)=>{const{name:s,type:i}=e[n];return"address"==i&&(r="41"+r.substr(2).toLowerCase()),t[s]=r,t},{}),t):t},code:s,accounts:a,base58:i,bytes:n,crypto:o};var bt={HttpProvider:class{constructor(t,e=3e4,r=!1,n=!1,s={},i="/"){if(!vt.isValidURL(t))throw new Error("Invalid URL provided to HttpProvider");if(isNaN(e)||e<0)throw new Error("Invalid timeout duration provided");if(!vt.isObject(s))throw new Error("Invalid headers object provided");"/"===t.charAt(t.length-1)&&(t=t.substr(0,t.length-2)),this.host=t,this.timeout=e,this.user=r,this.password=n,this.headers=s,this.statusPage=i,this.instance=l.a.create({baseURL:t,timeout:e,headers:s,auth:r&&{user:r,password:n}})}setStatusPage(t="/"){this.statusPage=t}async isConnected(t=this.statusPage){return this.request(t).then(t=>vt.hasProperties(t,"blockID","block_header")).catch(()=>!1)}request(t,e={},r="get"){return r=r.toLowerCase(),this.instance.request({data:"post"==r&&e,params:"get"==r&&e,url:t,method:r}).then(({data:t})=>t)}}},mt=r(3),yt=r.n(mt);class wt{constructor(t=!1){if(!t||!t instanceof _t)throw new Error("Expected instance of TronWeb");this.tronWeb=t,this.injectPromise=vt.promiseInjector(this)}sendTrx(t=!1,e=0,r=this.tronWeb.defaultAddress.hex,n=!1){return vt.isFunction(r)&&(n=r,r=this.tronWeb.defaultAddress.hex),n?this.tronWeb.isAddress(t)?!vt.isInteger(e)||e<=0?n("Invalid amount provided"):this.tronWeb.isAddress(r)?(t=this.tronWeb.address.toHex(t))===(r=this.tronWeb.address.toHex(r))?n("Cannot transfer TRX to the same account"):void this.tronWeb.fullNode.request("wallet/createtransaction",{to_address:t,owner_address:r,amount:parseInt(e)},"post").then(t=>{if(t.Error)return n(t.Error);n(null,t)}).catch(t=>n(t)):n("Invalid origin address provided"):n("Invalid recipient address provided"):this.injectPromise(this.sendTrx,t,e,r)}sendToken(t=!1,e=0,r=!1,n=this.tronWeb.defaultAddress.hex,s=!1){return vt.isFunction(n)&&(s=n,n=this.tronWeb.defaultAddress.hex),s?this.tronWeb.isAddress(t)?!vt.isInteger(e)||e<=0?s("Invalid amount provided"):vt.isString(r)&&r.length?this.tronWeb.isAddress(n)?(t=this.tronWeb.address.toHex(t),r=this.tronWeb.fromUtf8(r),t===(n=this.tronWeb.address.toHex(n))?s("Cannot transfer tokens to the same account"):void this.tronWeb.fullNode.request("wallet/transferasset",{to_address:t,owner_address:n,asset_name:r,amount:parseInt(e)},"post").then(t=>{if(t.Error)return s(t.Error);s(null,t)}).catch(t=>s(t))):s("Invalid origin address provided"):s("Invalid token ID provided"):s("Invalid recipient address provided"):this.injectPromise(this.sendToken,t,e,r,n)}purchaseToken(t=!1,e=!1,r=0,n=this.tronWeb.defaultAddress.hex,s=!1){return vt.isFunction(n)&&(s=n,n=this.tronWeb.defaultAddress.hex),s?this.tronWeb.isAddress(t)?vt.isString(e)&&e.length?!vt.isInteger(r)||r<=0?s("Invalid amount provided"):this.tronWeb.isAddress(n)?void this.tronWeb.fullNode.request("wallet/participateassetissue",{to_address:this.tronWeb.address.toHex(t),owner_address:this.tronWeb.address.toHex(n),asset_name:this.tronWeb.fromUtf8(e),amount:parseInt(r)},"post").then(t=>{if(t.Error)return s(t.Error);s(null,t)}).catch(t=>s(t)):s("Invalid buyer address provided"):s("Invalid token ID provided"):s("Invalid issuer address provided"):this.injectPromise(this.purchaseToken,t,e,r,n)}freezeBalance(t=this.tronWeb.defaultAddress.hex,e=0,r=3,n=!1){return vt.isFunction(r)&&(n=r,r=3),n?this.tronWeb.isAddress(t)?!vt.isInteger(e)||e<=0?n("Invalid amount provided"):!vt.isInteger(r)||r<3?n("Invalid duration provided, minimum of 3 days"):void this.tronWeb.fullNode.request("wallet/freezebalance",{owner_address:this.tronWeb.address.toHex(t),frozen_balance:parseInt(e),frozen_duration:parseInt(r)},"post").then(t=>{if(t.Error)return n(t.Error);n(null,t)}).catch(t=>n(t)):n("Invalid address provided"):this.injectPromise(this.freezeBalance,t,e,r)}unfreezeBalance(t=this.tronWeb.defaultAddress.hex,e=!1){return vt.isFunction(t)&&(e=t,t=this.tronWeb.defaultAddress.hex),e?this.tronWeb.isAddress(t)?void this.tronWeb.fullNode.request("wallet/unfreezebalance",{owner_address:this.tronWeb.address.toHex(t)},"post").then(t=>{if(t.Error)return e(t.Error);e(null,t)}).catch(t=>e(t)):e("Invalid address provided"):this.injectPromise(this.unfreezeBalance,t)}withdrawBlockRewards(t=this.tronWeb.defaultAddress.hex,e=!1){return vt.isFunction(t)&&(e=t,t=this.tronWeb.defaultAddress.hex),e?this.tronWeb.isAddress(t)?void this.tronWeb.fullNode.request("wallet/withdrawbalance",{owner_address:this.tronWeb.address.toHex(t)},"post").then(t=>{if(t.Error)return e(t.Error);e(null,t)}).catch(t=>e(t)):e("Invalid address provided"):this.injectPromise(this.withdrawBlockRewards,t)}applyForSR(t=this.tronWeb.defaultAddress.hex,e=!1,r=!1){return vt.isValidURL(t)&&(r=e||!1,e=t,t=this.tronWeb.defaultAddress.hex),r?this.tronWeb.isAddress(t)?vt.isValidURL(e)?void this.tronWeb.fullNode.request("wallet/createwitness",{owner_address:this.tronWeb.address.toHex(t),url:this.tronWeb.fromUtf8(e)},"post").then(t=>{if(t.Error)return r(t.Error);r(null,t)}).catch(t=>r(t)):r("Invalid url provided"):r("Invalid address provided"):this.injectPromise(this.applyForSR,t,e)}vote(t={},e=this.tronWeb.defaultAddress.hex,r=!1){if(vt.isFunction(e)&&(r=e,e=this.tronWeb.defaultAddress.hex),!r)return this.injectPromise(this.vote,t,e);if(!vt.isObject(t)||!Object.keys(t).length)return r("Invalid votes object provided");if(!this.tronWeb.isAddress(e))return r("Invalid voter address provided");let n=!1;t=Object.entries(t).map(([t,e])=>{if(!n)return this.tronWeb.isAddress(t)?!vt.isInteger(e)||e<=0?(r("Invalid vote count provided for SR: "+t),n=!0):{vote_address:this.tronWeb.address.toHex(t),vote_count:parseInt(e)}:(r("Invalid SR address provided: "+t),n=!0)}),n||this.tronWeb.fullNode.request("wallet/votewitnessaccount",{owner_address:this.tronWeb.address.toHex(e),votes:t},"post").then(t=>{if(t.Error)return r(t.Error);r(null,t)}).catch(t=>r(t))}createSmartContract(t={},e=this.tronWeb.defaultAddress.hex,r=!1){if(vt.isFunction(e)&&(r=e,e=this.tronWeb.defaultAddress.hex),!r)return this.injectPromise(this.createSmartContract,t,e);let{abi:n=!1,bytecode:s=!1,feeLimit:i=1e9,callValue:o=0,bandwidthLimit:a=0,parameters:d=[]}=t;if(n&&vt.isString(n))try{n=JSON.parse(n)}catch(t){return r("Invalid options.abi provided")}if(!vt.isArray(n))return r("Invalid options.abi provided");const c=n.some(t=>"constructor"==t.type&&t.payable);if(!vt.isHex(s))return r("Invalid options.bytecode provided");if(!vt.isInteger(i)||i<=0||i>1e9)return r("Invalid options.feeLimit provided");if(!vt.isInteger(o)||o<0)return r("Invalid options.callValue provided");if(c&&0==o)return r("When contract is payable, options.callValue must be a positive integer");if(!c&&o>0)return r("When contract is not payable, options.callValue must be 0");if(!vt.isInteger(a)||a<0||a>100)return r("Invalid options.bandwidthLimit provided");if(!vt.isArray(d))return r("Invalid parameters provided");if(!this.tronWeb.isAddress(e))return r("Invalid issuer address provided");if(d.length){const t=new yt.a.utils.AbiCoder,e=[],n=[];for(let t=0;t<d.length;t++){let{type:s,value:i}=d[t];if(!s||!vt.isString(s)||!s.length)return r("Invalid parameter type provided: "+s);"address"==s&&(i=this.tronWeb.address.toHex(i).replace(/^(41)/,"0x")),e.push(s),n.push(i)}try{d=t.encode(e,n).replace(/^(0x)/,"")}catch(t){return r(t)}}else d="";this.tronWeb.fullNode.request("wallet/deploycontract",{owner_address:this.tronWeb.address.toHex(e),fee_limit:parseInt(i),call_value:parseInt(o),consume_user_resource_percent:a,abi:JSON.stringify(n),bytecode:s,parameter:d},"post").then(t=>{if(t.Error)return r(t.Error);r(null,t)}).catch(t=>r(t))}triggerSmartContract(t,e,r=1e9,n=0,s=[],i=this.tronWeb.defaultAddress.hex,o=!1){if(vt.isFunction(i)&&(o=i,i=this.tronWeb.defaultAddress.hex),vt.isFunction(s)&&(o=s,s=[]),vt.isFunction(n)&&(o=n,n=0),vt.isFunction(r)&&(o=r,r=1e9),!o)return this.injectPromise(this.triggerSmartContract,t,e,r,n,s,i);if(!this.tronWeb.isAddress(t))return o("Invalid contract address provided");if(!vt.isString(e)||!e.length)return o("Invalid function selector provided");if(!vt.isInteger(n)||n<0)return o("Invalid call value provided");if(!vt.isInteger(r)||r<=0||r>1e9)return o("Invalid fee limit provided");if(!vt.isArray(s))return o("Invalid parameters provided");if(!this.tronWeb.isAddress(i))return o("Invalid issuer address provided");if(e=e.replace("/s*/g",""),s.length){const t=new yt.a.utils.AbiCoder,e=[],r=[];for(let t=0;t<s.length;t++){let{type:n,value:i}=s[t];if(!n||!vt.isString(n)||!n.length)return o("Invalid parameter type provided: "+n);"address"==n&&(i=this.tronWeb.address.toHex(i).replace(/^(41)/,"0x")),e.push(n),r.push(i)}try{s=t.encode(e,r).replace(/^(0x)/,"")}catch(t){return o(t)}}else s="";this.tronWeb.fullNode.request("wallet/triggersmartcontract",{contract_address:this.tronWeb.address.toHex(t),owner_address:this.tronWeb.address.toHex(i),function_selector:e,fee_limit:parseInt(r),call_value:parseInt(n),parameter:s},"post").then(t=>t.Error?o(t.Error):t.result&&t.result.message?o(this.tronWeb.toUtf8(t.result.message)):t.result.result?void o(null,t):o(t)).catch(t=>o(t))}createToken(t={},e=this.tronWeb.defaultAddress.hex,r=!1){if(vt.isFunction(e)&&(r=e,e=this.tronWeb.defaultAddress.hex),!r)return this.injectPromise(this.createToken,t,e);const{name:n=!1,abbreviation:s=!1,description:i=!1,url:o=!1,totalSupply:a=0,trxRatio:d=1,tokenRatio:c=1,saleStart:u=Date.now(),saleEnd:l=!1,freeBandwidth:h=0,freeBandwidthLimit:f=0,frozenAmount:p=0,frozenDuration:g=0}=t;return vt.isString(n)&&n.length?vt.isString(s)&&s.length?!vt.isInteger(a)||a<=0?r("Invalid supply amount provided"):!vt.isInteger(d)||d<=0?r("TRX ratio must be a positive integer"):!vt.isInteger(c)||c<=0?r("Token ratio must be a positive integer"):!vt.isInteger(u)||u<Date.now()?r("Invalid sale start timestamp provided"):!vt.isInteger(l)||l<=u?r("Invalid sale end timestamp provided"):vt.isString(i)&&i.length?vt.isString(o)&&o.length&&vt.isValidURL(o)?!vt.isInteger(h)||h<0?r("Invalid free bandwidth amount provided"):!vt.isInteger(f)||f<0||h&&!f?r("Invalid free bandwidth limit provided"):!vt.isInteger(p)||p<0||!g&&p?r("Invalid frozen supply provided"):!vt.isInteger(g)||g<0||g&&!p?r("Invalid frozen duration provided"):this.tronWeb.isAddress(e)?void this.tronWeb.fullNode.request("wallet/createassetissue",{owner_address:this.tronWeb.address.toHex(e),name:this.tronWeb.fromUtf8(n),abbr:this.tronWeb.fromUtf8(s),description:this.tronWeb.fromUtf8(i),url:this.tronWeb.fromUtf8(o),total_supply:parseInt(a),trx_num:parseInt(d),num:parseInt(c),start_time:parseInt(u),end_time:parseInt(l),free_asset_net_limit:parseInt(h),public_free_asset_net_limit:parseInt(f),frozen_supply:{frozen_amount:parseInt(p),frozen_days:parseInt(g)}},"post").then(t=>t.Error?r(t.Error):t.result&&t.result.message?r(this.tronWeb.toUtf8(t.result.message)):void r(null,t)).catch(t=>r(t)):r("Invalid issuer address provided"):r("Invalid token url provided"):r("Invalid token description provided"):r("Invalid token abbreviation provided"):r("Invalid token name provided")}updateToken(t={},e=this.tronWeb.defaultAddress.hex,r=!1){if(vt.isFunction(e)&&(r=e,e=this.tronWeb.defaultAddress.hex),!r)return this.injectPromise(this.updateToken,t,e);const{description:n=!1,url:s=!1,freeBandwidth:i=0,freeBandwidthLimit:o=0}=t;return!vt.isInteger(i)||i<0?r("Invalid free bandwidth amount provided"):!vt.isInteger(o)||o<0||i&&!o?r("Invalid free bandwidth limit provided"):this.tronWeb.isAddress(e)?void this.tronWeb.fullNode.request("wallet/updateasset",{owner_address:this.tronWeb.address.toHex(e),description:this.tronWeb.fromUtf8(n),url:this.tronWeb.fromUtf8(s),new_limit:parseInt(i),new_public_limit:parseInt(o)},"post").then(t=>t.Error?r(t.Error):t.result&&t.result.message?r(this.tronWeb.toUtf8(t.result.message)):void r(null,t)).catch(t=>r(t)):r("Invalid issuer address provided")}sendAsset(...t){return this.sendToken(...t)}purchaseAsset(...t){return this.purchaseToken(...t)}createAsset(...t){return this.createToken(...t)}updateAsset(...t){return this.updateToken(...t)}}class It{constructor(t=!1){if(!t||!t instanceof _t)throw new Error("Expected instance of TronWeb");this.tronWeb=t,this.injectPromise=vt.promiseInjector(this)}parseToken(t){return{...t,name:this.tronWeb.toUtf8(t.name),abbr:t.abbr&&this.tronWeb.toUtf8(t.abbr),description:t.description&&this.tronWeb.toUtf8(t.description),url:t.url&&this.tronWeb.toUtf8(t.url)}}getCurrentBlock(t=!1){if(!t)return this.injectPromise(this.getCurrentBlock);this.tronWeb.fullNode.request("wallet/getnowblock").then(e=>{t(null,e)}).catch(e=>t(e))}getBlock(t=this.tronWeb.defaultBlock,e=!1){return vt.isFunction(t)&&(e=t,t=this.tronWeb.defaultBlock),e?!1===t?e("No block identifier provided"):("earliest"==t&&(t=0),"latest"==t?this.getCurrentBlock(e):isNaN(t)&&vt.isHex(t)?this.getBlockByHash(t,e):void this.getBlockByNumber(t,e)):this.injectPromise(this.getBlock,t)}getBlockByHash(t,e=!1){if(!e)return this.injectPromise(this.getBlockByHash,t);this.tronWeb.fullNode.request("wallet/getblockbyid",{value:t},"post").then(t=>{if(!Object.keys(t).length)return e("Block not found");e(null,t)}).catch(t=>e(t))}getBlockByNumber(t,e=!1){return e?!vt.isInteger(t)||t<0?e("Invalid block number provided"):void this.tronWeb.fullNode.request("wallet/getblockbynum",{num:parseInt(t)},"post").then(t=>{if(!Object.keys(t).length)return e("Block not found");e(null,t)}).catch(t=>e(t)):this.injectPromise(this.getBlockByNumber,t)}getBlockTransactionCount(t=this.tronWeb.defaultBlock,e=!1){if(vt.isFunction(t)&&(e=t,t=this.tronWeb.defaultBlock),!e)return this.injectPromise(this.getBlockTransactionCount,t);this.getBlock(t).then(({transactions:t=[]})=>{e(null,t.length)}).catch(t=>e(t))}getTransactionFromBlock(t=this.tronWeb.defaultBlock,e=0,r=!1){return vt.isFunction(e)&&(r=e,e=0),vt.isFunction(t)&&(r=t,t=this.tronWeb.defaultBlock),r?!vt.isInteger(e)||e<0?r("Invalid transaction index provided"):void this.getBlock(t).then(({transactions:t=!1})=>{if(!t||t.length<e)return r("Transaction not found in block");r(null,t[e])}).catch(t=>r(t)):this.injectPromise(this.getTransactionFromBlock,t,e)}getTransaction(t,e=!1){if(!e)return this.injectPromise(this.getTransaction,t);this.tronWeb.fullNode.request("wallet/gettransactionbyid",{value:t},"post").then(t=>{if(!Object.keys(t).length)return e("Transaction not found");e(null,t)}).catch(t=>e(t))}getTransactionInfo(t,e=!1){if(!e)return this.injectPromise(this.getTransactionInfo,t);this.tronWeb.solidityNode.request("walletsolidity/gettransactioninfobyid",{value:t},"post").then(t=>{e(null,t)}).catch(t=>e(t))}getTransactionsToAddress(t=this.tronWeb.defaultAddress.hex,e=30,r=0,n=!1){return vt.isFunction(r)&&(n=r,r=0),vt.isFunction(e)&&(n=e,e=30),n?this.getTransactionsRelated(t,"to",e,r,n):this.injectPromise(this.getTransactionsToAddress,t,e,r)}getTransactionsFromAddress(t=this.tronWeb.defaultAddress.hex,e=30,r=0,n=!1){return vt.isFunction(r)&&(n=r,r=0),vt.isFunction(e)&&(n=e,e=30),n?this.getTransactionsRelated(t,"from",e,r,n):this.injectPromise(this.getTransactionsFromAddress,t,e,r)}async getTransactionsRelated(t=this.tronWeb.defaultAddress.hex,e="all",r=30,n=0,s=!1){if(vt.isFunction(n)&&(s=n,n=0),vt.isFunction(r)&&(s=r,r=30),vt.isFunction(e)&&(s=e,e="all"),vt.isFunction(t)&&(s=t,t=this.tronWeb.defaultAddress.hex),!s)return this.injectPromise(this.getTransactionsRelated,t,e,r,n);if(!["to","from","all"].includes(e))return s('Invalid direction provided: Expected "to", "from" or "all"');if("all"==e)try{const e=await this.getTransactionsRelated(t,"from",r,n),i=await this.getTransactionsRelated(t,"to",r,n);return s(null,[...e.map(t=>(t.direction="from",t)),...i.map(t=>(t.direction="to",t))].sort((t,e)=>e.raw_data.timestamp-t.raw_data.timestamp))}catch(t){return s(t)}return this.tronWeb.isAddress(t)?!vt.isInteger(r)||r<0||n&&r<1?s("Invalid limit provided"):!vt.isInteger(n)||n<0?s("Invalid offset provided"):(t=this.tronWeb.address.toHex(t),void this.tronWeb.solidityNode.request(`walletextension/gettransactions${e}this`,{account:{address:t},offset:n,limit:r},"post").then(({transaction:t})=>{s(null,t)}).catch(t=>s(t))):s("Invalid address provided")}getAccount(t=this.tronWeb.defaultAddress.hex,e=!1){return vt.isFunction(t)&&(e=t,t=this.tronWeb.defaultAddress.hex),e?this.tronWeb.isAddress(t)?(t=this.tronWeb.address.toHex(t),void this.tronWeb.solidityNode.request("walletsolidity/getaccount",{address:t},"post").then(t=>{e(null,t)}).catch(t=>e(t))):e("Invalid address provided"):this.injectPromise(this.getAccount,t)}getBalance(t=this.tronWeb.defaultAddress.hex,e=!1){if(vt.isFunction(t)&&(e=t,t=this.tronWeb.defaultAddress.hex),!e)return this.injectPromise(this.getBalance,t);this.getAccount(t).then(({balance:t=0})=>{e(null,t)}).catch(t=>e(t))}getBandwidth(t=this.tronWeb.defaultAddress.hex,e=!1){return vt.isFunction(t)&&(e=t,t=this.tronWeb.defaultAddress.hex),e?this.tronWeb.isAddress(t)?(t=this.tronWeb.address.toHex(t),void this.tronWeb.fullNode.request("wallet/getaccountnet",{address:t},"post").then(({freeNetUsed:t=0,freeNetLimit:r=0,NetUsed:n=0,NetLimit:s=0})=>{e(null,r-t+(s-n))}).catch(t=>e(t))):e("Invalid address provided"):this.injectPromise(this.getBandwidth,t)}getTokensIssuedByAddress(t=this.tronWeb.defaultAddress.hex,e=!1){return vt.isFunction(t)&&(e=t,t=this.tronWeb.defaultAddress.hex),e?this.tronWeb.isAddress(t)?(t=this.tronWeb.address.toHex(t),void this.tronWeb.fullNode.request("wallet/getassetissuebyaccount",{address:t},"post").then(({assetIssue:t=!1})=>{if(!t)return e(null,{});const r=t.map(t=>this.parseToken(t)).reduce((t,e)=>(t[e.name]=e,t),{});e(null,r)}).catch(t=>e(t))):e("Invalid address provided"):this.injectPromise(this.getTokensIssuedByAddress,t)}getTokenFromID(t=!1,e=!1){return e?vt.isString(t)&&t.length?void this.tronWeb.fullNode.request("wallet/getassetissuebyname",{value:this.tronWeb.fromUtf8(t)},"post").then(t=>{if(!t.name)return e("Token does not exist");e(null,this.parseToken(t))}).catch(t=>e(t)):e("Invalid token ID provided"):this.injectPromise(this.getTokenFromID,t)}listNodes(t=!1){if(!t)return this.injectPromise(this.listNodes);this.tronWeb.fullNode.request("wallet/listnodes").then(({nodes:e=[]})=>{t(null,e.map(({address:{host:t,port:e}})=>`${this.tronWeb.toUtf8(t)}:${e}`))}).catch(e=>t(e))}getBlockRange(t=0,e=30,r=!1){return vt.isFunction(e)&&(r=e,e=30),vt.isFunction(t)&&(r=t,t=0),r?!vt.isInteger(t)||t<0?r("Invalid start of range provided"):!vt.isInteger(e)||e<=t?r("Invalid end of range provided"):void this.tronWeb.fullNode.request("wallet/getblockbylimitnext",{startNum:parseInt(t),endNum:parseInt(e)+1},"post").then(({block:t=[]})=>{r(null,t)}).catch(t=>r(t)):this.injectPromise(this.getBlockRange,t,e)}listSuperRepresentatives(t=!1){if(!t)return this.injectPromise(this.listSuperRepresentatives);this.tronWeb.fullNode.request("wallet/listwitnesses").then(({witnesses:e=[]})=>{t(null,e)}).catch(e=>t(e))}listTokens(t=0,e=0,r=!1){return vt.isFunction(e)&&(r=e,e=0),vt.isFunction(t)&&(r=t,t=0),r?!vt.isInteger(t)||t<0||e&&t<1?r("Invalid limit provided"):!vt.isInteger(e)||e<0?r("Invalid offset provided"):t?void this.tronWeb.fullNode.request("wallet/getpaginatedassetissuelist",{offset:parseInt(e),limit:parseInt(t)},"post").then(({assetIssue:t=[]})=>{r(null,t.map(t=>this.parseToken(t)))}).catch(t=>r(t)):this.tronWeb.fullNode.request("wallet/getassetissuelist").then(({assetIssue:t=[]})=>{r(null,t.map(t=>this.parseToken(t)))}).catch(t=>r(t)):this.injectPromise(this.listTokens,t,e)}timeUntilNextVoteCycle(t=!1){if(!t)return this.injectPromise(this.timeUntilNextVoteCycle);this.tronWeb.fullNode.request("wallet/getnextmaintenancetime").then(({num:e=-1})=>{if(-1==e)return t("Failed to get time until next vote cycle");t(null,Math.floor(e/1e3))}).catch(e=>t(e))}getContract(t,e=!1){return e?this.tronWeb.isAddress(t)?(t=this.tronWeb.address.toHex(t),void this.tronWeb.fullNode.request("wallet/getcontract",{value:t}).then(t=>{if(t.Error)return e("Contract does not exist");e(null,t)}).catch(t=>e(t))):e("Invalid contract address provided"):this.injectPromise(this.getContract,t)}sign(t=!1,e=this.tronWeb.defaultPrivateKey,r=!1){if(vt.isFunction(e)&&(r=e,e=this.tronWeb.defaultPrivateKey),!r)return this.injectPromise(this.sign,t,e);if(!vt.isObject(t))return r("Invalid transaction provided");if(t.signature)return r("Transaction is already signed");try{return this.tronWeb.address.toHex(this.tronWeb.address.fromPrivateKey(e)).toLowerCase()!==t.raw_data.contract[0].parameter.value.owner_address.toLowerCase()?r("Private key does not match address in transaction"):r(null,vt.crypto.signTransaction(e,t))}catch(t){r(t)}}sendRawTransaction(t=!1,e=!1){return e?vt.isObject(t)?t.signature&&vt.isArray(t.signature)?void this.tronWeb.fullNode.request("wallet/broadcasttransaction",t,"post").then(t=>{e(null,t)}).catch(t=>e(t)):e("Transaction is not signed"):e("Invalid transaction provided"):this.injectPromise(this.sendRawTransaction,t)}async sendTransaction(t=!1,e=!1,r=this.tronWeb.defaultPrivateKey,n=!1){if(vt.isFunction(r)&&(n=r,r=this.tronWeb.defaultPrivateKey),!n)return this.injectPromise(this.sendTransaction,t,e,r);if(!this.tronWeb.isAddress(t))return n("Invalid recipient provided");if(!vt.isInteger(e)||e<=0)return n("Invalid amount provided");try{const s=this.tronWeb.address.fromPrivateKey(r),i=await this.tronWeb.transactionBuilder.sendTrx(t,e,s),o=await this.sign(i,r);return n(null,await this.sendRawTransaction(o))}catch(t){return n(t)}}async sendToken(t=!1,e=!1,r=!1,n=this.tronWeb.defaultPrivateKey,s=!1){if(vt.isFunction(n)&&(s=n,n=this.tronWeb.defaultPrivateKey),!s)return this.injectPromise(this.sendToken,t,e,r,n);if(!this.tronWeb.isAddress(t))return s("Invalid recipient provided");if(!vt.isInteger(e)||e<=0)return s("Invalid amount provided");if(!vt.isString(r))return s("Invalid token ID provided");try{const i=this.tronWeb.address.fromPrivateKey(n),o=await this.tronWeb.transactionBuilder.sendToken(t,e,r,i),a=await this.sign(o,n);return s(null,await this.sendRawTransaction(a))}catch(t){return s(t)}}sendAsset(...t){return this.sendToken(...t)}send(...t){return this.sendTransaction(...t)}sendTrx(...t){return this.sendTransaction(...t)}broadcast(...t){return this.sendRawTransaction(...t)}signTransaction(...t){return this.sign(...t)}}class At{}const Wt=new yt.a.utils.AbiCoder,xt=t=>t.name+"("+St(t.inputs||[]).join(",")+")",St=t=>t.map(({type:t})=>t),kt=(t,e)=>{const r=t.map(({name:t})=>t).filter(t=>!!t),n=t.map(({type:t})=>t);return Wt.decode(n,e).reduce((t,e,s)=>("address"==n[s]&&(e="41"+e.substr(2).toLowerCase()),r.length?t[r[s]]=e:t.push(e),t),r.length?{}:[])};class Pt{constructor(t,e){this.tronWeb=t.tronWeb,this.contract=t,this.abi=e,this.name=e.name,this.inputs=e.inputs||[],this.outputs=e.outputs||[],this.signature=this.tronWeb.sha3(e.name).slice(0,8),this.functionSelector=xt(e),this.injectPromise=vt.promiseInjector(this),this.defaultOptions={feeLimit:1e9,callValue:0,from:this.tronWeb.defaultAddress.hex,shouldPollResponse:!0}}onMethod(...t){const e=St(this.inputs);return t.forEach((r,n)=>{"address"==e[n]&&(t[n]=this.tronWeb.address.toHex(r).replace(/^(41)/,"0x"))}),{call:(...r)=>this._call(e,t,...r),send:(...r)=>this._send(e,t,...r),watch:(...t)=>this._watch(...t)}}async _call(t,e,r={},n=!1){if(vt.isFunction(r)&&(n=r,r={}),!n)return this.injectPromise(this._call,t,e,r);if(t.length!==e.length)return n("Invalid argument count provided");if(!this.contract.address)return n("Smart contract is missing address");if(!this.contract.deployed)return n("Calling smart contracts requires you to load the contract first");const{stateMutability:s}=this.abi;if(!["pure","view"].includes(s.toLowerCase()))return n(`Methods with state mutability "${s}" must use send()`);r={...this.defaultOptions,...r};const i=e.map((e,r)=>({type:t[r],value:e}));this.tronWeb.transactionBuilder.triggerSmartContract(this.contract.address,this.functionSelector,r.feeLimit,r.callValue,i,this.tronWeb.address.toHex(r.from),(t,e)=>{if(t)return n(t);if(!vt.hasProperty(e,"constant_result"))return n("Failed to execute");try{let t=kt(this.outputs,"0x"+e.constant_result[0]);return 1===t.length&&(t=t[0]),n(null,t)}catch(t){return n(t)}})}async _send(t,e,r={},n=this.tronWeb.defaultPrivateKey,s=!1){if(vt.isFunction(n)&&(s=n,n=this.tronWeb.defaultPrivateKey),vt.isFunction(r)&&(s=r,r={}),!s)return this.injectPromise(this._send,t,e,r,n);if(t.length!==e.length)throw new Error("Invalid argument count provided");if(!this.contract.address)return s("Smart contract is missing address");if(!this.contract.deployed)return s("Calling smart contracts requires you to load the contract first");if(!n||!vt.isString(n))return s("Invalid private key provided");const{stateMutability:i}=this.abi;if(["pure","view"].includes(i.toLowerCase()))return s(`Methods with state mutability "${i}" must use call()`);r={...this.defaultOptions,...r};const o=e.map((e,r)=>({type:t[r],value:e}));try{const t=this.tronWeb.address.fromPrivateKey(n),e=await this.tronWeb.transactionBuilder.triggerSmartContract(this.contract.address,this.functionSelector,r.feeLimit,r.callValue,o,this.tronWeb.address.toHex(t));if(!e.result||!e.result.result)return s("Unknown error: "+JSON.stringify(e,null,2));const i=await this.tronWeb.trx.sign(e.transaction,n),a=await this.tronWeb.trx.sendRawTransaction(i);if(!a.result)return s("Unknown error: "+JSON.stringify(a,null,2));if(!r.shouldPollResponse)return s(null,i.txID);const d=async(t=0)=>{if(20==t)return s({error:"Cannot find result in solidity node",transaction:i});const e=await this.tronWeb.trx.getTransactionInfo(i.txID);if(!Object.keys(e).length)return setTimeout(()=>{d(t+1)},3e3);if(e.result&&"FAILED"==e.result)return s({error:this.tronWeb.toUtf8(e.resMessage),transaction:i,output:e});if(!vt.hasProperty(e,"contractResult"))return s({error:"Failed to execute: "+JSON.stringify(e,null,2),transaction:i,output:e});let r=kt(this.outputs,"0x"+e.contractResult[0]);return 1===r.length&&(r=r[0]),s(null,r)};d()}catch(t){return s(t)}}async _watch(t=!1){if(!vt.isFunction(t))throw new Error("Expected callback to be provided");if(!this.contract.address)return t("Smart contract is missing address");if("event"!==this.abi.type.toLowerCase())return t("Invalid method type for event watching");if(!this.tronWeb.eventServer)return t("No event server configured");let e=!1,r=!1;const n=async()=>{try{const t=await this.tronWeb.getEventResult(this.contract.address,this.name),[e]=t.sort((t,e)=>e.block-t.block),n=t.filter((e,n)=>{return!t.slice(0,n).some(t=>JSON.stringify(t)==JSON.stringify(e))&&(!r||e.block>r)});return e&&(r=e.block),n}catch(t){return Promise.reject(t)}},s=()=>{e&&clearInterval(e),e=setInterval(()=>{n().then(e=>e.forEach(e=>{t(null,vt.parseEvent(e,this.abi))})).catch(e=>t(e))},3e3)};return await n(),s(),{start:s(),stop:()=>{e&&(clearInterval(e),e=!1)}}}}class Ct{constructor(t=!1,e=[],r=!1){if(!t||!t instanceof _t)throw new Error("Expected instance of TronWeb");this.tronWeb=t,this.injectPromise=vt.promiseInjector(this),this.address=r,this.abi=e,this.eventListener=!1,this.bytecode=!1,this.deployed=!1,this.lastBlock=!1,this.methods={},this.props=[],this.tronWeb.isAddress(r)?this.deployed=!0:this.address=!1,this.loadAbi(e)}async _getEvents(){const t=await this.tronWeb.getEventResult(this.address),[e]=t.sort((t,e)=>e.block-t.block),r=t.filter((e,r)=>{return!t.slice(0,r).some(t=>JSON.stringify(t)==JSON.stringify(e))&&(!this.lastBlock||e.block>this.lastBlock)});return e&&(this.lastBlock=e.block),r}async _startEventListener(t){if(this.eventListener&&clearInterval(this.eventListener),!this.tronWeb.eventServer)throw new Error("Event server is not configured");if(!this.address)throw new Error("Contract is not configured with an address");this.eventCallback=t,await this._getEvents(),this.eventListener=setInterval(()=>{this._getEvents().then(t=>t.forEach(t=>{this.eventCallback&&this.eventCallback(t)})).catch(t=>{console.error("Failed to get event list",t)})},3e3)}_stopEventListener(){this.eventListener&&(clearInterval(this.eventListener),this.eventListener=!1,this.eventCallback=!1)}hasProperty(t){return this.hasOwnProperty(t)||this.__proto__.hasOwnProperty(t)}loadAbi(t){this.abi=t,this.methods={},this.props.forEach(t=>delete this[t]),t.forEach(t=>{const e=new Pt(this,t),r=e.onMethod.bind(e),{name:n,functionSelector:s,signature:i}=e;this.methods[n]=r,this.methods[s]=r,this.methods[i]=r,this.hasProperty(n)||(this[n]=r,this.props.push(n)),this.hasProperty(s)||(this[s]=r,this.props.push(s)),this.hasProperty(i)||(this[i]=r,this.props.push(i))})}async new(t,e=this.tronWeb.defaultPrivateKey,r=!1){if(vt.isFunction(e)&&(r=e,e=this.tronWeb.defaultPrivateKey),!r)return this.injectPromise(this.new,t,e);try{const n=this.tronWeb.address.fromPrivateKey(e),s=await this.tronWeb.transactionBuilder.createSmartContract(t,n),i=await this.tronWeb.trx.sign(s,e),o=await this.tronWeb.trx.sendRawTransaction(i);return o.result?this.at(i.contract_address,r):r("Unknown error: "+JSON.stringify(o,null,2))}catch(t){return r(t)}}async at(t,e=!1){if(!e)return this.injectPromise(this.at,t);try{const r=await this.tronWeb.trx.getContract(t);r.contract_address||e("Unknown error: "+JSON.stringify(r,null,2)),this.address=r.contract_address,this.bytecode=r.bytecode,this.deployed=!0,this.loadAbi(r.abi.entrys),e(null,this)}catch(t){return t.toString().includes("does not exist")?e("Contract has not been deployed on the network"):e(t)}}events(t=!1){if(!vt.isFunction(t))throw new Error("Callback function expected");const e=this;return{start(r=!1){return r?(e._startEventListener(t).then(()=>{r()}).catch(t=>{r(t)}),this):(e._startEventListener(t),this)},stop(){e._stopEventListener()}}}}r.d(e,"default",function(){return _t});class _t{constructor(t,e,r=!1,n=!1){vt.isString(t)&&(t=new bt.HttpProvider(t)),vt.isString(e)&&(e=new bt.HttpProvider(e)),this.setFullNode(t),this.setSolidityNode(e),this.setEventServer(r),this.providers=bt,this.BigNumber=gt.a,this.defaultBlock=!1,this.defaultPrivateKey=!1,this.defaultAddress={hex:!1,base58:!1},["sha3","toHex","toUtf8","fromUtf8","toAscii","fromAscii","toDecimal","fromDecimal","toSun","fromSun","toBigNumber","isAddress","compile","createAccount","address"].forEach(t=>{this[t]=_t[t]}),n&&this.setPrivateKey(n),this.transactionBuilder=new wt(this),this.trx=new It(this),this.witness=new At(this),this.injectPromise=vt.promiseInjector(this)}setDefaultBlock(t=!1){if(!1===t||"latest"==t||"earliest"==t)return this.defaultBlock=t;if(!vt.isInteger(t)||!t)throw new Error("Invalid block ID provided");this.defaultBlock=+t}setPrivateKey(t){this.setAddress(this.address.fromPrivateKey(t)),this.defaultPrivateKey=t}setAddress(t){if(!this.isAddress(t))throw new Error("Invalid address provided");const e=this.address.toHex(t),r=this.address.fromHex(t);this.defaultPrivateKey&&this.address.fromPrivateKey!==e&&(this.defaultPrivateKey=!1),this.defaultAddress={hex:e,base58:r}}isValidProvider(t){return Object.values(bt).some(e=>t instanceof e)}isEventServerConnected(){return!!this.eventServer&&l.a.get(this.eventServer).then(({data:t})=>vt.hasProperty(t,"_links")).catch(()=>!1)}setFullNode(t){if(!this.isValidProvider(t))throw new Error("Invalid full node provided");this.fullNode=t,this.fullNode.setStatusPage("wallet/getnowblock")}setSolidityNode(t){if(!this.isValidProvider(t))throw new Error("Invalid solidity node provided");this.solidityNode=t,this.solidityNode.setStatusPage("walletsolidity/getnowblock")}setEventServer(t=!1){if(!1!==t&&!vt.isValidURL(t))throw new Error("Invalid URL provided for event server");this.eventServer=t}currentProviders(){return{fullNode:this.fullNode,solidityNode:this.solidityNode,eventServer:this.eventServer}}currentProvider(){return this.currentProviders()}getEventResult(t=!1,e=!1,r=!1,n=!1){if(!n)return this.injectPromise(this.getEventResult,t,e,r);this.eventServer||n("No event server configured");const s=[];return this.isAddress(t)?e&&!t?n("Usage of event name filtering requires a contract address"):r&&!e?n("Usage of block number filtering requires an event name"):(t&&s.push(this.address.fromHex(t)),e&&s.push(e),r&&s.push(r),l()(`${this.eventServer}/event/contract/${s.join("/")}`).then(({data:t=!1})=>t?vt.isArray(t)?n(null,t.map(t=>vt.mapEvent(t))):n(t):n("Unknown error occurred")).catch(t=>n(t.response.data||t))):n("Invalid contract address provided")}getEventByTransacionID(t=!1,e=!1){return e?(this.eventServer||e("No event server configured"),l()(`${this.eventServer}/event/transaction/${t}`).then(({data:t=!1})=>t?vt.isArray(t)?e(null,t.map(t=>vt.mapEvent(t))):e(t):e("Unknown error occurred")).catch(t=>e(t.response.data||t))):this.injectPromise(this.getEventByTransacionID,t)}contract(t=[],e=!1){return new Ct(this,t,e)}static get address(){return{fromHex:t=>vt.isHex(t)?vt.crypto.getBase58CheckAddress(vt.code.hexStr2byteArray(t)):t,toHex:t=>vt.isHex(t)?t.toLowerCase():vt.code.byteArray2hexStr(vt.crypto.decodeBase58Address(t)).toLowerCase(),fromPrivateKey(t){try{return vt.crypto.pkToAddress(t)}catch(t){return!1}}}}static sha3(t){return Object(V.sha3_256)(t)}static toHex(t){if(vt.isBoolean(t))return _t.fromDecimal(+t);if(vt.isBigNumber(t))return _t.fromDecimal(t);if("object"==typeof t)return _t.fromUtf8(JSON.stringify(t));if(vt.isString(t)){if(0===t.indexOf("-0x"))return _t.fromDecimal(t);if(0===t.indexOf("0x"))return t;if(!isFinite(t))return _t.fromUtf8(t)}return _t.fromDecimal(t)}static toUtf8(t){return Buffer.from(t,"hex").toString("utf8")}static fromUtf8(t){return Buffer.from(t,"utf8").toString("hex")}static toAscii(t){return Buffer.from(t,"hex").toString("ascii")}static fromAscii(t,e){return Buffer.from(t,"ascii").toString("hex").padEnd(e,"0")}static toDecimal(t){return _t.toBigNumber(t).toNumber()}static fromDecimal(t){const e=_t.toBigNumber(t),r=e.toString(16);return e.lessThan(0)?"-0x"+r.substr(1):"0x"+r}static fromSun(t){const e=_t.toBigNumber(e).div(1e6);return vt.isBigNumber(t)?e:e.toString(10)}static toSun(t){const e=_t.toBigNumber(t).times(1e6);return vt.isBigNumber(t)?e:e.toString(10)}static toBigNumber(t=0){return vt.isBigNumber(t)?t:!vt.isString(t)||0!==t.indexOf("0x")&&0!==t.indexOf("-0x")?new gt.a(t.toString(10),10):new gt.a(t.replace("0x",""),16)}static isAddress(t=!1){return!!vt.isString(t)&&(42===t.length?_t.isAddress(vt.crypto.getBase58CheckAddress(vt.code.hexStr2byteArray(t))):vt.crypto.isAddressValid(t))}static compile(t){}static async createAccount(t=!1){const e=vt.accounts.generateAccount();return t&&t(null,e),e}async isConnected(t=!1){if(!t)return this.injectPromise(this.isConnected);t(null,{fullNode:await this.fullNode.isConnected(),solidityNode:await this.solidityNode.isConnected(),eventServer:await this.isEventServerConnected()})}}c()(_t,"providers",bt),c()(_t,"BigNumber",gt.a)}]).default;
//# sourceMappingURL=TronWeb.node.js.map